<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>flowChart</title>
    <!-- <link rel="stylesheet" type="text/css" href="css/style.css" /> -->
	<link type="text/css" href="css/Semantic-UI-CSS-master/semantic.min.css" rel="stylesheet">
	<link type="text/css" href="css/graph-creator.css" rel="stylesheet" />
	<link type="text/css" href="css/flow_zyl.css"  rel="stylesheet"/>
	<link type="text/css" href="css/jquery.mCustomScrollbar.css" rel="stylesheet">
</head>
<body>
	<div class="subheader editor-toolbar">
		<div class="column pop-btn" data-content="保存" data-position="bottom center" data-variation="mini"><i class="save icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="剪切" data-position="bottom center" data-variation="mini"><i class="cut icon"></i></div>
		<div class="column pop-btn" data-content="复制" data-position="bottom center" data-variation="mini"><i class="copy icon"></i></div>
		<div class="column pop-btn" data-content="粘贴" data-position="bottom center" data-variation="mini"><i class="paste icon"></i></div>
		<div class="column pop-btn" id="delete-graph" data-content="清空" data-position="bottom center" data-variation="mini"><i class="trash icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="撤销" data-position="bottom center" data-variation="mini"><i class="repeat icon"></i></div>
		<div class="column pop-btn" data-content="恢复" data-position="bottom center" data-variation="mini"><i class="undo icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="放大" data-position="bottom center" data-variation="mini"><i class="zoom icon"></i></div>
		<div class="column pop-btn" data-content="缩小" data-position="bottom center" data-variation="mini"><i class="zoom out icon"></i></div>
		<div class="column pop-btn" id="reset-zoom" data-content="最大化" data-position="bottom center" data-variation="mini"><i class="maximize icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="导入json" data-position="bottom center" data-variation="mini"><i class="sign in icon"></i></div>
		<div class="column pop-btn small popup" data-content="导出json" data-position="bottom center" data-variation="mini"><i class="sign out icon"></i></div>
	</div>
	<div class="full">
		<div id="flowComponents" class="full-left">
			<div class="components-btn noComponent" name="selectBtn">
				<img src="icons/activity/list/type.manual.png"><span>选择</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="startComponent" type="" for-name="circle">
				<img id="img" src="icons/startevent/none.png"/><span>开始</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="endComponent" type="" for-name="circle">
				<img src="icons/endevent/none.png"><span>结束</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="activityComponent" type="activity" for-name="rect">
				<img src="icons/activity/list/type.user.png"><span>普通活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="blockActivity" type="activity" for-name="">
				<img src="icons/activity/task.png"><span>块活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="subFlowActivity" type="activity" for-name="">
				<img src="icons/activity/event.subprocess.png"><span>子活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="routeActivity" type="activity" for-name="">
				<img src="icons/activity/list/type.receive.png"><span>路径活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn noComponent" name="drawLineBtn" for-name="line">
				<img src="icons/connector/sequenceflow.png"><span>线</span>
			</div>
			<div class="clearfix"></div>
			
		</div>
		<div class="full-right tab">
			<div id="container" class="ui top attached tab active full-right-top view" data-tab="first"></div>
			<div id="xpdlContainer" class="ui top attached tab view content-div" data-tab="second">
				<xmp>
					
				</xmp>
			</div>
			<div id="xmlContainer" class="ui top attached tab view content-div" data-tab="third">
				<xmp>
					
				</xmp>
			</div>
			<div class="full-right-btn ui bottom attached tabular menu">
				<a class="item active" data-tab="first">图标视图</a>
				<a class="item" data-tab="second">xpdl视图</a>
				<a class="item" data-tab="third">xml视图</a>
			</div>
			<div id="propertiesWrapper" class="full-right-bottom">
				<div class="component-name"><i class="angle double down icon"></i><span>普通活动</span></div>
				<div class="component-prop content-div">
					
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
	</div>
	<!-- 导入导出弹出层 -->
	<div class="ui small modal json_data">
	  	<i class="close icon"></i>
	  	<div class="header">
	   		导入数据
	  	</div>
	  	<div class="content">
	    	<textarea></textarea>
	  	</div>
	  	<div class="actions">
	      	<div class="ui negative button">No </div>
	      	<div class="ui positive right labeled icon button">Yes <i class="checkmark icon"></i> </div>
	    </div>
	</div>

	<script type="text/javascript" src="js/jquery.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/common.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/d3.v3.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/juicer-min.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/semantic/semantic.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/jquery.mCustomScrollbar.concat.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/vkbeautify.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/flowchart_zyl.js" charset="utf-8"></script>
	
	<script>
		juicer.set({  
			'tag::operationOpen': '{@',  
			'tag::operationClose': '}',  
			'tag::interpolateOpen': '{{=',  
			'tag::interpolateClose': '}}'  
		});  
	</script>

	<script id="tpl" type="text/template">
	    <activity Id="{{=activity.id}}" Name="{{=activity.title}}" form-id="" formdisplayschema="" hisformdisplayschema="">
	        <operations/>
	        <text-limit/>
	    </activity>
	       
	</script>

	<script>
		var Word = randomWord(false, 8);
		var workflow_name = '过程';
		var workflow_id = 'Package_'+Word+'_Wor1';
		var creat_time = new Date().pattern("yyyy-MM-dd hh:mm:ss");
		var svg_ns = "http://www.w3.org/2000/svg";
		var mySvg;
		var initParameter = { //初始化shape参数
				circle: 'cx:100,cy:100,r:20',
				rect: 'x:177,y:49,width:80,height:50',
				line: 'x1:550,y1:50,x2:650,y2:150'
			};
		var commonParameter = 'stroke:#AA99FF,stroke-width:2,fill:none'; //shape共同参数
	
		$(function(){
			// mySvg = mySvg||createSVG();
			/*// 点击生成svg图形
			$('.components-btn img,span').on('click', function(){
				var shape_name  = $(this).parents('.components-btn').attr('for-name');
				createShape(shape_name);
	            // mySvg.appendChild(shape);
			});*/
			$('#container').on('click', '.component span', function(){
				alert("component被点击");
			});
			//编辑工具
			$('.editor-toolbar .icon.save').on('click', function(){
				alert('保存');
			});
			//控制属性显示
			$('.component-name').on('click', function(){
				if ($('.component-prop').is(':hidden')) {
					$('.full-right-bottom ').css({height: '30%'});
					$('.view').css({height: '65%'});
					$('.component-name .icon').removeClass('up').addClass('down');
					$('.component-prop').toggle('slow');
				}else{
					$('.full-right-bottom ').css({height: '8%'});
					$('.view').css({height: '87%'});
					$('.component-name .icon').removeClass('down').addClass('up');
					$('.component-prop').toggle();
				}
			});
			//选择左侧工具
			$('#flowComponents .components-btn').on('click', function(){
				$(this).siblings().removeClass('active').end().addClass('active');
				if('drawLineBtn'==$(this).attr('name')){
					$('#container').on('mouseover mouseout', '.conceptG', function(){
						if(event.type == 'mouseover'){
	        				this.style.cursor = 'crosshair';
	     				}else if(event.type == 'mouseout'){
	        				this.style.cursor = 'default';
	      				}
						
					});
				}else{
					$('#container').off('mouseover mouseout', '.conceptG');
				}
			});
		})
	
		// 创建 svg 对象
		function createSVG(){
			var svg = d3.select('#container')
				.append('svg:svg')
				.attr('width', '100%')
				.attr('height', '100%');
	            return svg;
		}
		// 创建 shape（流程图形块）
		function createShape(shape_name, shapeId, position, shapeLabel){
	        if (position) {
	        	initParameter = { //初始化shape参数
					circle:'cx:'+position.x+',cy:'+position.y+',r:20',
					rect:'x:'+ (position.x-40)+',y:'+(position.y-25)+',width:80,height:50',
					line:'x1:'+(position.x-50)+',y1:'+position.y+',x2:'+(position.x+50)+',y2:'+position.y+''
				};
	        };
			var attrs = initParameter[shape_name].split(',');
	        var g = mySvg.append('g')
	        	.attr('id', shapeId);
	        var shape = g.append(shape_name);
	        var text = g.append("text")
			    .attr("text-anchor", "middle")
			    .attr("dy", "-" + 7.5)
			    .append('tspan').text(shapeLabel)
			    .attr('x', position.x).attr('dy', position.y);
	        for (var i=0,j=attrs.length;i<j;i++) { //遍历初始化shape参数
	            var attr_single = attrs[i].split(":");
	            var name = attr_single[0], 
	            	value = attr_single[1];
	            shape.attr(name, value);
	        }
	        var com_attrs = commonParameter.split(',');
	        for (var i=0,j=com_attrs.length;i<j;i++) { //遍历shape共同参数
	            var com_single = com_attrs[i].split(':');
	            shape.attr(com_single[0], com_single[1]);
	        }
	        return shape;
		}
		
	    
	</script>
	<script>
		$(function(){
			var initProp = '<div>'+
								'<div name="id" class="prop-value"><span>id:</span><span>'+workflow_id+'</span></div>'+
								'<div name="name" class="prop-value"><span>名称:</span><span>'+workflow_name+'</span></div>'+
							'</div>'+
							'<div class="clearfix"></div>';
			$('.component-prop').append(initProp);
			$('.component-name span').text(workflow_name);
			$('.menu .item').tab();//标签显示必须放updateScrollbar之前

			function updateScrollbar(){
				var dataTab = $(this).attr('data-tab');
				if(dataTab=='third'){ //xml视图
					var customScrollbar=$("#xmlContainer").find(".mCSB_scrollTools");
					// customScrollbar.css({"opacity":0});
					$("#xmlContainer").mCustomScrollbar("update");
					// customScrollbar.animate({opacity:1},"slow");
				}
				if(dataTab=='second'){ //xml视图
					var customScrollbar=$("#xpdlContainer").find(".mCSB_scrollTools");
					$("#xpdlContainer").mCustomScrollbar("update");
				}
			}
			$('.menu .item').on('click', updateScrollbar);
		})
		//semantic初始化
		$(function(){
			$('.pop-btn').popup();

		})
		//jquery插件滚动条
		$(window).load(function(){
            $(".content-div").mCustomScrollbar();
        });
	</script>
</body>
</html
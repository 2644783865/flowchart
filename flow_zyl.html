<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>flowChart</title>
    <!-- <link rel="stylesheet" type="text/css" href="css/style.css" /> -->
	<link type="text/css" href="css/Semantic-UI-CSS-master/semantic.min.css" rel="stylesheet">
	<link type="text/css" href="css/graph-creator.css" rel="stylesheet" />
	<link type="text/css" href="css/flow_zyl.css"  rel="stylesheet"/>
	<link type="text/css" href="css/jquery.mCustomScrollbar.css" rel="stylesheet">
</head>
<body>
	<div class="subheader editor-toolbar">
		<div class="column pop-btn" data-content="保存" data-position="bottom center" data-variation="mini"><i class="save icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="剪切" data-position="bottom center" data-variation="mini"><i class="cut icon"></i></div>
		<div class="column pop-btn" data-content="复制" data-position="bottom center" data-variation="mini"><i class="copy icon"></i></div>
		<div class="column pop-btn" data-content="粘贴" data-position="bottom center" data-variation="mini"><i class="paste icon"></i></div>
		<div class="column pop-btn" id="delete-graph" data-content="清空" data-position="bottom center" data-variation="mini"><i class="trash icon"></i></div>
		<div class="column pop-btn" id="delete-ele" data-content="删除" data-position="bottom center" data-variation="mini"><i class="remove icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="撤销" data-position="bottom center" data-variation="mini"><i class="repeat icon"></i></div>
		<div class="column pop-btn" data-content="恢复" data-position="bottom center" data-variation="mini"><i class="undo icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="放大" data-position="bottom center" data-variation="mini"><i class="zoom icon"></i></div>
		<div class="column pop-btn" data-content="缩小" data-position="bottom center" data-variation="mini"><i class="zoom out icon"></i></div>
		<div class="column pop-btn" id="reset-zoom" data-content="归位" data-position="bottom center" data-variation="mini"><i class="maximize icon"></i></div>
		<div class="divider"></div>
		<div class="column pop-btn" data-content="导入json" data-position="bottom center" data-variation="mini"><i class="sign in icon"></i></div>
		<div class="column pop-btn small popup" data-content="导出json" data-position="bottom center" data-variation="mini"><i class="sign out icon"></i></div>
	</div>
	<div class="full">
		<div id="flowComponents" class="full-left">
			<div class="components-btn noComponent selectBtn" name="selectBtn">
				<img src="icons/activity/select.png"><span>选择</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="startComponent" type="start" for-name="circle">
				<img id="img" src="icons/startevent/none.png"/><span>开始</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="endComponent" type="end" for-name="circle">
				<img src="icons/endevent/none.png"><span>结束</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="activityComponent" type="activity" for-name="rect">
				<img src="icons/activity/list/type.user.png"><span>普通活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="blockActivity" type="activity" for-name="">
				<img src="icons/activity/task.png"><span>块活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="subFlowActivity" type="activity" for-name="">
				<img src="icons/activity/event.subprocess.png"><span>子活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn" name="routeActivity" type="activity" for-name="">
				<img src="icons/activity/list/type.receive.png"><span>路径活动</span>
			</div>
			<div class="clearfix"></div>
			<div class="components-btn noComponent" name="drawLineBtn" for-name="line">
				<img src="icons/connector/sequenceflow.png"><span>线</span>
			</div>
			<div class="clearfix"></div>
			
		</div>
		<div class="full-right tab">
		<form id="containerForm" method="post" action="http://localhost:8088/platform/wfdman/insert.do">
			<div id="container" class="ui top attached tab active full-right-top view" data-tab="first">
				<!-- svg -->
			</div>
			<div id="xpdlContainer" class="ui top attached tab view content-div" data-tab="second">
				<xmp>
					<!-- xpdl -->
				</xmp>
			</div>
			<div id="xmlContainer" class="ui top attached tab view content-div" data-tab="third">
				<xmp>
					<!-- xml -->
				</xmp>
			</div>
			<div class="full-right-btn ui bottom attached tabular menu">
				<a class="item active" data-tab="first">图标视图</a>
				<a class="item" data-tab="second">xpdl视图</a>
				<a class="item" data-tab="third">xml视图</a>
			</div>
			<div id="propertiesWrapper" class="full-right-bottom">
				<div class="component-name"><i class="angle double down icon"></i><span>普通活动</span></div>
				<div class="component-prop content-div">
					<!-- activity属性 -->
				</div>
			</div>

			<input name="xpdlcontent" type="hidden" value="">
			<input name="xmlcontent" type="hidden" value="">

			<input type="hidden" id="wFID" name="wFID" value="">
			<input type="hidden" id="wFType" name="wFType" value="money">
			<input type="hidden" id="subType" name="subType" value="">
			<input type="hidden" id="depart" name="depart" value="">
			<input type="hidden" id="departID" name="departID" value="">
			<input type="hidden" id="formName" name="formName" value="">
			<input type="hidden" id="formId" name="formId" value="">
			<input type="hidden" id="formType" name="formType" value="wfd_form">
			<input type="hidden" id="mode" name="mode" value="">
			<input type="hidden" id="dt" name="dt" onFocus="WdatePicker({dateFmt:'dd HH:mm',skin:'blue'});" value="">
			<input type="hidden" id="dataObjectID" name="dataObjectID" value="">
			<input type="hidden" id="securityID" name="securityID" value="">
			<input type="hidden" id="securityName" name="securityName" value="">
			<input type="hidden" id="orderNo" name="orderNo" value="">
		</form>
		</div>
		<div class="clearfix"></div>
	</div>
	<!-- 导入导出弹出层 -->
	<div class="ui small modal json_data">
	  	<i class="close icon"></i>
	  	<div class="header">
	   		导入数据
	  	</div>
	  	<div class="content">
	    	<textarea></textarea>
	  	</div>
	  	<div class="actions">
	      	<div class="ui negative button">No </div>
	      	<div class="ui positive right labeled icon button">Yes <i class="checkmark icon"></i> </div>
	    </div>
	</div>
	<!-- 右键菜单 -->
	<div id="rMenu" class="ui vertical mini menu">
		<a class="item" name="removeMenu">删除<i class="remove icon"></i></a>
		<a class="item" name="propMenu">属性<i class="book icon"></i></a>
		<a class="item" name="toFront">置前<i class="object ungroup icon"></i></a>
	</div>
	<!-- 属性弹出层 -->
	<div class="ui coupled modal prop_layer">
	  	<div class="ui pointing secondary menu">
		  <a class="item active" data-tab="one">常规</a>
		  <a class="item" data-tab="two">工具</a>
		  <a class="item" data-tab="three">前置条件</a>
		  <a class="item" data-tab="four">后置条件</a>
		  <a class="item" data-tab="five">扩展属性集</a>
		  <a class="item" data-tab="six">超时限制</a>
		  <a class="item" data-tab="seven">高级</a>
		  <a class="item" data-tab="eight">监控信息</a>
		</div>
		<!-- 常规item start -->
		<div class="ui tab segment active" data-tab="one">
			<div class="ui mini form">
				<div class="fields">
				    <div class="five wide field">
				      <label>ID:</label>
				      <input type="text" placeholder="ID">
				    </div>
				    <div class="five wide field">
				      <label>名称:</label>
				      <input type="text" placeholder="名称">
				    </div>
				    <div class="five wide field">
					    <label>类型:</label>
					    <input type="text" placeholder="类型">
					</div>
				</div>
				
				<div class="ui divider"></div>
				<div class="field">
    				<label>参与者集:</label>
					<div class="two fields">
						<div class="five wide field">
                		  	<select class="ui search dropdown">
      							<option value="">请选择</option>
      							<option value="1">参与者1</option>
      							<option value="2">参与者2</option>
							</select>      					
                		</div>
                		<div class="five wide field">
							<button class="ui facebook mini button definitionBtn"><i class="write icon"></i>定义</button>
                		</div>
                	</div>
                </div>
                <div class="fields">
                	<div class="inline field">
    				  	<div class="ui checkbox">
    				  	  	<input type="checkbox" tabindex="0" class="hidden">
    				  	  	<label>是否全程跟踪</label>
    				  	</div>
    				</div>
    				<div class="inline field">
    				  	<div class="ui checkbox">
    				  	  	<input type="checkbox" tabindex="0" class="hidden">
    				  	  	<label>是否自动接收任务委派</label>
    				  	</div>
    				</div>
				</div>
				<div class="ui divider"></div>
				<div class="fields">
					<div class="five wide field">
					    <label>开始模式:</label>
					    <select class="ui search dropdown">
					      <option value="">选择</option>
					      <option value="1">模式1</option>
					      <option value="2">模式2</option>
					    </select>
					</div>
					<div class="five wide field">
					    <label>完成模式:</label>
					    <select class="ui search dropdown">
					      <option value="">选择</option>
					      <option value="1">模式1</option>
					      <option value="2">模式2</option>
					    </select>
					</div>
				    <div class="five wide field">
				      <label>优先级:</label>
				      <input type="text" placeholder="名称">
				    </div>
				</div>
				<div class="fields">
                	<div class="inline field">
    				  	<div class="ui checkbox">
    				  	  	<input type="checkbox" tabindex="0" class="hidden">
    				  	  	<label>是否多人处理</label>
    				  	</div>
    				</div>
    				<div class="inline field">
    				  	<div class="ui checkbox">
    				  	  	<input type="checkbox" tabindex="0" class="hidden">
    				  	  	<label>多人处理是否顺序执行</label>
    				  	</div>
    				</div>
    				<div class="inline field">
    				  	<div class="ui checkbox">
    				  	  	<input type="checkbox" tabindex="0" class="hidden">
    				  	  	<label>按参与者生成环节实例</label>
    				  	</div>
    				</div>
				</div>
				<div class="field">
    			  	<label>描述：</label>
    			  	<textarea rows="2"></textarea>
    			</div>
    			<div class="fields">
					<div class="five wide field">
					    <label>任务委派规则:</label>
					    <select class="ui search dropdown">
					      <option value="">选择</option>
					      <option value="1">模式1</option>
					      <option value="2">模式2</option>
					    </select>
					</div>
					<div class="five wide field">
					    <label>必须结束环节:</label>
					    <select class="ui search dropdown">
					      <option value="">选择</option>
					      <option value="1">模式1</option>
					      <option value="2">模式2</option>
					    </select>
					</div>
				</div>
			</div>
		</div><!-- 常规item end -->
		<!-- 工具item start -->
		<div class="ui tab segment" data-tab="two">
			<div class="fields" >
				<button class="ui green mini button showDialog"><i class="icon plus"></i> 添 加</button>
				<button class="ui facebook mini button showDialog"><i class="icon write"></i> 编 辑</button>
				<button class="ui youtube mini button"><i class="icon remove"></i> 删 除</button>
			</div>
			<div class="ui divider"></div>
			<div class="fields">
				<table class="ui blue sortable selectable celled striped compact table">
					<thead>
						<tr>
							<th class="one wide">选择</th>
							<th class="five wide">标题1</th>
							<th class="five wide">标题2</th>
							<th class="five wide">标题3</th>
						</tr>
					</thead>
					<tbody>
						<tr id="tr1">
							<td>
								<div class="ui radio checkbox">
									<input type="radio" name="selectAnswer" tabindex="0" class="hidden">
								</div>
							</td>
							<td>1111111</td>
							<td>bell</td>
							<td>Cell</td>
						</tr>
						<tr>
							<td>
								<div class="ui radio checkbox">
									<input type="radio" name="selectAnswer" tabindex="0" class="hidden">
								</div>
							</td>
							<td>aell</td>
							<td>Cell</td>
							<td>tell</td>
						</tr>
					</tbody>
					<tfoot>
						<tr><th colspan="4">
							<div class="ui right floated pagination menu">
								<a class="icon item">
									<i class="left chevron icon"></i>
								</a>
								<a class="item">1</a>
								<a class="item">2</a>
								<a class="item">3</a>
								<a class="item">4</a>
								<a class="icon item">
									<i class="right chevron icon"></i>
								</a>
							</div>
						</th></tr>
					</tfoot>
				</table>
			</div>
		</div><!-- 工具item end -->
		<div class="ui tab segment" data-tab="three">
			third
		</div>
		<div class="ui tab segment" data-tab="four">
			four
		</div>
		<div class="ui tab segment" data-tab="five">
			five
		</div>
		<div class="ui tab segment" data-tab="six">
			six
		</div>
		<div class="ui tab segment" data-tab="seven">
			seven
		</div>
		<div class="ui tab segment" data-tab="eight">
			eight
		</div>
	  	<div class="actions">
	      	<div class="ui negative right labeled icon button">No <i class="remove icon"></i></div>
	      	<div class="ui positive right labeled icon button">Yes <i class="checkmark icon"></i> </div>
	    </div>
	</div>
	<!-- 活动属性-定义参与者集 -->
	<div class="ui small second coupled modal">
  	  	<div class="ui pointing secondary menu">
		  	<a class="item active" data-tab="definition_1">常规</a>
		  	<a class="item" data-tab="definition_2">高级</a>
		</div>
		<div class="ui tab segment active" data-tab="definition_1">
			<div class="ui mini form">
			    <div class="five wide field">
			      	<label>ID:</label>
			      	<input type="text" placeholder="ID">
			    </div>
			    <div class="five wide field">
			      	<label>名称:</label>
			      	<input type="text" placeholder="名称">
			    </div>
				<div class="field">
    			  	<label>描述：</label>
    			  	<textarea rows="2"></textarea>
    			</div>
			    <div class="five wide field">
				    <label>自定义参与者:</label>
				    <input type="text" placeholder="自定义参与者">
				</div>
			</div>
		</div>
		<div class="ui tab segment" data-tab="definition_2">
			<div class="ui top attached tabular menu">
	    	  	<a class="active item" data-tab="definition_2/a">一般</a>
	    	  	<a class="item" data-tab="definition_2/b">创建人</a>
	    	  	<a class="item" data-tab="definition_2/c">发送人</a>
	    	  	<a class="item" data-tab="definition_2/d">前一环节创建人</a>
	    	  	<a class="item" data-tab="definition_2/e">历史环节处理人</a>
	    	</div>
	    	<div class="ui bottom attached active tab segment" data-tab="definition_2/a">
				1A
	    	</div>
	    	<div class="ui bottom attached tab segment" data-tab="definition_2/b">1B</div>
	    	<div class="ui bottom attached tab segment" data-tab="definition_2/c">1C</div>
	    	<div class="ui bottom attached tab segment" data-tab="definition_2/d">1D</div>
	    	<div class="ui bottom attached tab segment" data-tab="definition_2/e">1E</div>
		</div>
		<div class="actions inverted segment">
			<button class="ui right floated green inverted ok button">
				<i class="checkmark icon"></i>确定
			</button>
			<button class="ui right floated red inverted cancel button">
				<i class="remove icon"></i>取消
			</button>
		</div>

  	</div>

	<script type="text/javascript" src="js/jquery.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/common.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/d3.v3.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/juicer-min.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/semantic/semantic.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/jquery.mCustomScrollbar.concat.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/vkbeautify.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/svg.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/flowchart_zyl.js" charset="utf-8"></script>
	
	<script>
		juicer.set({  
			'tag::operationOpen': '{@',  
			'tag::operationClose': '}',  
			'tag::interpolateOpen': '{{=',  
			'tag::interpolateClose': '}}'  
		});  
	</script>

	<script id="tpl" type="text/template"><!-- 可以通过模板生成activity，暂时没用 -->
	    <activity Id="{{=activity.id}}" Name="{{=activity.title}}" form-id="" formdisplayschema="" hisformdisplayschema="">
	        <operations/>
	        <text-limit/>
	    </activity>
	</script>

	<script>
		var Word = randomWord(false, 8);
		var workflow_name = '过程';
		var workflow_id = 'Package_' + Word + '_Wor1';
		var activitySets = workflow_id + 'Ase1';
		var package_id = workflow_id.substring(0, workflow_id.lastIndexOf('_'));
		var creat_time = new Date().pattern("yyyy-MM-dd HH:mm:ss");
	
		$(function(){			
			//编辑工具(保存)
			$('.editor-toolbar .icon.save').on('click', function(){
				var dataTab = $('.full-right-btn .item.active').attr('data-tab');
				$('.full-right-btn .item').not($('.full-right-btn .item.active')).trigger('click');//触发点击事件获取xpdl和xml
				$('.full-right-btn .item[data-tab="'+dataTab+'"]').trigger('click');
				var xpdl = $('#xpdlContainer xmp').text();
				var xml = $('#xmlContainer xmp').text();
				var xpdl_top =
					'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+
				    '<Package xmlns="http://www.wfmc.org/2002/XPDL1.0" xmlns:xpdl="http://www.wfmc.org/2002/XPDL1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Id="'+package_id+'" Name="新包" xsi:schemaLocation="http://www.wfmc.org/2002/XPDL1.0 http://wfmc.org/standards/dtd/TC-1025_schema_10_xpdl.xsd">\n'+
				    '    <PackageHeader>'+
				    '        <XPDLVersion>1.0</XPDLVersion>'+
				    '        <Vendor>GENTLESOFT</Vendor>'+
				    '        <Created>'+creat_time+'</Created>'+
				    '    </PackageHeader>'+
				    '    <RedefinableHeader PublicationStatus="UNDER_TEST">'+
				    '        <Author>管理员</Author>'+
				    '        <Version>1.0</Version>'+
				    '    </RedefinableHeader>'+
				    '    <ConformanceClass GraphConformance="NON_BLOCKED"/>'+
				    '    <Script Type="text/javascript"/>'+
				    '    <DataFields>'+
				    '        <DataField Id="sourceReferenceId" IsArray="FALSE" Name="sourceReferenceId">'+
				    '            <DataType>'+
				    '                <BasicType Type="STRING"/>'+
				    '            </DataType>'+
				    '            <InitialValue>null</InitialValue>'+
				    '        </DataField>'+
				    '        <DataField Id="formId" IsArray="FALSE" Name="formId">'+
				    '            <DataType>'+
				    '                <BasicType Type="STRING"/>'+
				    '            </DataType>'+
				    '            <InitialValue>null</InitialValue>'+
				    '        </DataField>'+
				    '        <DataField Id="nextActivityInfo" IsArray="FALSE" Name="nextActivityInfo">'+
				    '            <DataType>'+
				    '                <ExternalReference location="org.gentlesoft.wf.NextActivitiesParty"/>'+
				    '            </DataType>'+
				    '            <InitialValue>null</InitialValue>'+
				    '        </DataField>'+
				    '        <DataField Id="nextActivityName" IsArray="FALSE" Name="nextActivityName">'+
				    '            <DataType>'+
				    '                <ExternalReference location="java.util.ArrayList"/>'+
				    '            </DataType>'+
				    '            <InitialValue>null</InitialValue>'+
				    '        </DataField>'+
				    '        <DataField Id="formType" IsArray="FALSE" Name="formType">'+
				    '            <DataType>'+
				    '                <BasicType Type="STRING"/>'+
				    '            </DataType>'+
				    '            <InitialValue>null</InitialValue>'+
				    '        </DataField>'+
				    '    </DataFields>';
				var xpdl_end = 
					'    <ExtendedAttributes>'+
				    '        <ExtendedAttribute Name="MadeBy" Value="com.gentlesoft.tools.wfd"/>'+
				    '        <ExtendedAttribute Name="Version" Value="1.4.2"/>'+
				    '    </ExtendedAttributes>'+
				    '</Package>';
				var xml_top = '<?xml version="1.0" encoding="UTF-8"?><pkg-config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Id="'+package_id+'" Name="新包" Version="" xsi:noNamespaceSchemaLocation="../dtd/flowactconfig.xsd">';
				var xml_end = '</pkg-config>';
				xpdl = vkbeautify.xml(xpdl_top + xpdl + xpdl_end);
				xml = vkbeautify.xml(xml_top + xml + xml_end);
				$('input[name="xpdlcontent"]').val(xpdl);
				$('input[name="xmlcontent"]').val(xpdl);
				/*
				console.log('xpdl:');
				console.log(xpdl);
				console.log('xml:');
				console.log(xml);*/
				$('#containerForm').submit();
				
			});
			//控制属性显示
			$('.component-name').on('click', function(){
				if ($('.component-prop').is(':hidden')) {
					$('.full-right-bottom ').css({height: '30%'});
					$('.view').css({height: '65%'});
					$('.component-name .icon').removeClass('up').addClass('down');
					$('.component-prop').toggle('slow');
				}else{
					$('.full-right-bottom ').css({height: '8%'});
					$('.view').css({height: '87%'});
					$('.component-name .icon').removeClass('down').addClass('up');
					$('.component-prop').toggle();
				}
			});
			//选择左侧工具
			$('#flowComponents .components-btn').on('click', function(){
				$(this).siblings().removeClass('active').end().addClass('active');
				if('drawLineBtn'==$(this).attr('name')){
					$('#container').on('mouseover mouseout', '.conceptG', function(){
						if(event.type == 'mouseover'){
	        				this.style.cursor = 'crosshair';
	     				}else if(event.type == 'mouseout'){
	        				this.style.cursor = 'default';
	      				}
					});
				}else{
					$('#container').off('mouseover mouseout', '.conceptG');
				}
			});
			
		})
	    
	</script>
	<script>
		$(function(){
			var initProp = '<div>'+
								'<div name="id" class="prop-value"><span>id:</span><span>'+workflow_id+'</span></div>'+
								'<div name="name" class="prop-value"><span>名称:</span><span>'+workflow_name+'</span></div>'+
							'</div>'+
							'<div class="clearfix"></div>';
			$('.component-prop').append(initProp);
			$('.component-name span').text(workflow_name);
			$('.menu .item').tab();//标签显示必须放updateScrollbar之前

			$('.menu .item').on('click', updateScrollbar);
		})
		
		$(function(){
			$('#rMenu').hide();
			//semantic初始化
			$('.pop-btn').popup();
			//jquery插件滚动条
			$(".content-div").mCustomScrollbar();
			//活动属性semantic初始化
			$('.prop_layer .menu .item').tab();
			$('select.dropdown').dropdown();
			$('.ui.checkbox').checkbox();

			$('.coupled.modal').modal({allowMultiple: true});
			// open second modal on first modal buttons
			$('.second.modal').modal('attach events', '.modal.prop_layer .definitionBtn');
		})

		function updateScrollbar(){
			var dataTab = $(this).attr('data-tab');
			if(dataTab=='third'){ //xml视图
				var customScrollbar=$("#xmlContainer").find(".mCSB_scrollTools");
				// customScrollbar.css({"opacity":0});
				$("#xmlContainer").mCustomScrollbar("update");
				// customScrollbar.animate({opacity:1},"slow");
			}
			if(dataTab=='second'){ //xml视图
				var customScrollbar=$("#xpdlContainer").find(".mCSB_scrollTools");
				$("#xpdlContainer").mCustomScrollbar("update");
			}
		}
	</script>
</body>
</html>